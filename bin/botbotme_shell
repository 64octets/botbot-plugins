#!/usr/bin/env python
import sys
from importlib import import_module

from botbotme_plugins.base import DummyApp, BasePlugin
import botbotme_plugins.plugins


def register_plugins(app, modules=None):
    """Imports the plugin modules to register them with the app router"""
    modules = modules and modules.split(',') or []
    if not modules:
        modules = botbotme_plugins.plugins.__all__
    for mod in modules:
        import_module('botbotme_plugins.plugins.' + mod)

    for plugin in BasePlugin._plugins:
        app.register(plugin())


if __name__ == '__main__':
    app = DummyApp()
    if len(sys.argv) > 1:
        register_plugins(app, sys.argv[1])
    else:
        register_plugins(app)
    app.cmdloop()
